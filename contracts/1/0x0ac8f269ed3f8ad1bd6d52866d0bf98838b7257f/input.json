{"language":"Solidity","settings":{"libraries":{},"metadata":{"useLiteralContent":true},"optimizer":{"enabled":true,"runs":200},"remappings":[],"outputSelection":{"*":{"*":["*"],"":["*"]}}},"sources":{"browser/Rebaser.sol":{"content":"pragma solidity ^0.6.6;\r\n\r\nabstract contract RebasableContract {\r\n    function rebase(int supplyDelta) virtual external returns (uint);\r\n}\r\n\r\nabstract contract SyncableContract {\r\n    function sync() virtual external;\r\n}\r\n\r\ncontract RebaserV2 {\r\n    \r\n    modifier onlyOwner() {\r\n        require(owner == msg.sender, \"Ownable: caller is not the owner\");\r\n        _;\r\n    }\r\n    \r\n    uint public initTime;\r\n    uint public secondsPerSupplyBlock = 86400;\r\n    RebasableContract orbiContract;\r\n    RebasableContract twin0Contract;\r\n    RebasableContract twin1Contract;\r\n    SyncableContract twin0LiqContract;\r\n    SyncableContract twin1LiqContract;\r\n    SyncableContract orbiLiqContract;\r\n    address public orbiAddress;\r\n    address public twin0Address;\r\n    address public twin1Address;\r\n    address public orbiLiqAddress;\r\n    address public twin0LiqAddress;\r\n    address public twin1LiqAddress;\r\n    address public owner;\r\n    uint public orbiSupplyTotal = 100000000000000000;\r\n    uint public twin0SupplyTotal = 10000000000000;\r\n    uint public twin1SupplyTotal = 10000000000000;\r\n    uint[] public twinSupplyList = [10000000000000, 10867767478235, 11563662964936,  \r\n                                    11949855824364, 11949855824364, 11563662964936,  \r\n                                    10867767478235, 10000000000000,  9132232521765, \r\n                                     8436337035064,  8050144175636,  8050144175636, \r\n                                     8436337035064,  9132232521765];\r\n    uint[] public orbiSupplyList = [110000000000000000, 109009688679024191, 106234898018587335,\r\n                                    102225209339563144,  97774790660436856,  93765101981412665,\r\n                                     90990311320975809,  90000000000000000,  90990311320975809,\r\n                                     93765101981412665,  97774790660436856, 102225209339563144,\r\n                                    106234898018587335, 109009688679024191];\r\n    \r\n    constructor() public {\r\n        owner = msg.sender;\r\n        initTime = now - now % 3600 + 7200;\r\n    }\r\n    \r\n    function rebaseTwins(int supplyDelta0, int supplyDelta1) external onlyOwner returns (bool) {\r\n        twin0Contract.rebase(supplyDelta0);\r\n        twin1Contract.rebase(supplyDelta1);\r\n    }\r\n    \r\n    function rebaseOrbi(int supplyDelta) external onlyOwner returns (bool) {\r\n        orbiContract.rebase(supplyDelta);\r\n    }\r\n    \r\n    function changeOwner(address newOwner) external onlyOwner returns (bool) {\r\n        owner = newOwner;\r\n        return true;\r\n    }\r\n    \r\n    function changeOrbiSupplyList(uint[] calldata newSupplyList) external onlyOwner returns (bool) {\r\n        orbiSupplyList = newSupplyList;\r\n        return true;\r\n    }\r\n    \r\n    function changeTwinSupplyList(uint[] calldata newSupplyList) external onlyOwner returns (bool) {\r\n        twinSupplyList = newSupplyList;\r\n        return true;\r\n    }\r\n    \r\n    function setTwins(address twin0Addr, address twin1Addr, address twin0LiqAddr, address twin1LiqAddr) external onlyOwner returns (bool) {\r\n        require(twin0Address == address(0) && twin1Address == address(0), \"TWINS_ALREADY_SET\");\r\n        twin0Address = twin0Addr;\r\n        twin0Contract = RebasableContract(twin0Addr);\r\n        twin1Address = twin1Addr;\r\n        twin1Contract = RebasableContract(twin1Addr);\r\n        twin0LiqAddress = twin0LiqAddr;\r\n        twin0LiqContract = SyncableContract(twin0LiqAddr);\r\n        twin1LiqAddress = twin1LiqAddr;\r\n        twin1LiqContract = SyncableContract(twin1LiqAddr);\r\n        return true;\r\n     }  \r\n     \r\n    function setOrbi(address orbiAddr, address orbiLiqAddr) external onlyOwner returns (bool) {\r\n        require(orbiAddress == address(0), \"ORBI_ALREADY_SET\");\r\n        orbiAddress = orbiAddr;\r\n        orbiContract = RebasableContract(orbiAddr);\r\n        orbiLiqAddress = orbiLiqAddr;\r\n        orbiLiqContract = SyncableContract(orbiLiqAddr);\r\n        return true;\r\n    }\r\n    \r\n    function rebase() external returns (bool) {\r\n        uint twin0NewSupply = twinSupplyList[(now - initTime) / secondsPerSupplyBlock % 14];\r\n        uint twin1NewSupply = twinSupplyList[((now - initTime) / secondsPerSupplyBlock + 7) % 14];\r\n        uint orbiNewSupply = orbiSupplyList[(now - initTime) / secondsPerSupplyBlock % 14];\r\n        bool twin0Synced = false;\r\n        bool twin1Synced = false;\r\n        require(orbiNewSupply != orbiSupplyTotal || (twin0NewSupply != twin0SupplyTotal && twin1NewSupply != twin1SupplyTotal), \"SUPPLY_UNCHANGED\");\r\n        if (twin0NewSupply != twin0SupplyTotal && twin1NewSupply != twin1SupplyTotal) {\r\n            twin0Contract.rebase(int(twin0NewSupply) - int(twin0SupplyTotal));\r\n            if (int(twin0NewSupply) - int(twin0SupplyTotal) < 0) {\r\n                twin0LiqContract.sync();\r\n                twin0Synced = true;\r\n            }\r\n            twin1Contract.rebase(int(twin1NewSupply) - int(twin1SupplyTotal));\r\n            if (int(twin1NewSupply) - int(twin1SupplyTotal) < 0) {\r\n                twin1LiqContract.sync();\r\n                twin1Synced = true;\r\n            }\r\n            twin0SupplyTotal = twin0NewSupply;\r\n            twin1SupplyTotal = twin1NewSupply;\r\n        }\r\n        if (orbiNewSupply != orbiSupplyTotal) {\r\n            orbiContract.rebase(int(orbiNewSupply) - int(orbiSupplyTotal));\r\n            if (int(orbiNewSupply) - int(orbiSupplyTotal) < 0) {\r\n                orbiLiqContract.sync();\r\n                if (!twin0Synced) {\r\n                    twin0LiqContract.sync();\r\n                }\r\n                if (!twin1Synced) {\r\n                    twin1LiqContract.sync();\r\n                }\r\n            }\r\n            orbiSupplyTotal = orbiNewSupply;\r\n        }\r\n        return true;\r\n    }\r\n    \r\n}"}}}