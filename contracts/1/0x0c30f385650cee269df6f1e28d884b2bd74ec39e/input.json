{"language":"Solidity","settings":{"libraries":{},"metadata":{"useLiteralContent":true},"optimizer":{"enabled":false,"runs":200},"remappings":[],"outputSelection":{"*":{"*":["*"],"":["*"]}}},"sources":{"DeporBetaUsers.sol":{"content":"pragma solidity >=0.4.23 <0.6.0;\r\n\r\nlibrary Roles {\r\n    struct Role {\r\n        mapping(address => bool) bearer;\r\n    }\r\n\r\n    /**\r\n     * @dev Give an account access to this role.\r\n     */\r\n    function add(Role storage role, address account) internal {\r\n        require(!has(role, account), \"Roles: account already has role\");\r\n        role.bearer[account] = true;\r\n    }\r\n\r\n    /**\r\n     * @dev Remove an account's access to this role.\r\n     */\r\n    function remove(Role storage role, address account) internal {\r\n        require(has(role, account), \"Roles: account does not have role\");\r\n        role.bearer[account] = false;\r\n    }\r\n\r\n    /**\r\n     * @dev Check if an account has this role.\r\n     * @return bool\r\n     */\r\n    function has(Role storage role, address account)\r\n        internal\r\n        view\r\n        returns (bool)\r\n    {\r\n        require(account != address(0), \"Roles: account is the zero address\");\r\n        return role.bearer[account];\r\n    }\r\n}\r\n\r\ncontract WhitelistAdminRole {\r\n    using Roles for Roles.Role;\r\n\r\n    event WhitelistAdminAdded(address indexed account);\r\n    event WhitelistAdminRemoved(address indexed account);\r\n\r\n    Roles.Role private _whitelistAdmins;\r\n\r\n    constructor() internal {\r\n        _addWhitelistAdmin(msg.sender);\r\n    }\r\n\r\n    modifier onlyWhitelistAdmin() {\r\n        require(\r\n            isWhitelistAdmin(msg.sender),\r\n            \"WhitelistAdminRole: caller does not have the WhitelistAdmin role\"\r\n        );\r\n        _;\r\n    }\r\n\r\n    function isWhitelistAdmin(address account) public view returns (bool) {\r\n        return _whitelistAdmins.has(account);\r\n    }\r\n\r\n    function addWhitelistAdmin(address account) public onlyWhitelistAdmin {\r\n        _addWhitelistAdmin(account);\r\n    }\r\n\r\n    function renounceWhitelistAdmin() public {\r\n        _removeWhitelistAdmin(msg.sender);\r\n    }\r\n\r\n    function _addWhitelistAdmin(address account) internal {\r\n        _whitelistAdmins.add(account);\r\n        emit WhitelistAdminAdded(account);\r\n    }\r\n\r\n    function removeWhitelistAdmin(address account) public onlyWhitelistAdmin {\r\n        _removeWhitelistAdmin(account);\r\n    }\r\n\r\n    function _removeWhitelistAdmin(address account) internal {\r\n        _whitelistAdmins.remove(account);\r\n        emit WhitelistAdminRemoved(account);\r\n    }\r\n}\r\n\r\ncontract PauserRole {\r\n    using Roles for Roles.Role;\r\n\r\n    event PauserAdded(address indexed account);\r\n    event PauserRemoved(address indexed account);\r\n\r\n    Roles.Role private _pausers;\r\n\r\n    constructor() internal {\r\n        _addPauser(msg.sender);\r\n    }\r\n\r\n    modifier onlyPauser() {\r\n        require(\r\n            isPauser(msg.sender),\r\n            \"PauserRole: caller does not have the Pauser role\"\r\n        );\r\n        _;\r\n    }\r\n\r\n    function isPauser(address account) public view returns (bool) {\r\n        return _pausers.has(account);\r\n    }\r\n\r\n    function addPauser(address account) public onlyPauser {\r\n        _addPauser(account);\r\n    }\r\n\r\n    function renouncePauser() public {\r\n        _removePauser(msg.sender);\r\n    }\r\n\r\n    function _addPauser(address account) internal {\r\n        _pausers.add(account);\r\n        emit PauserAdded(account);\r\n    }\r\n\r\n    function _removePauser(address account) internal {\r\n        _pausers.remove(account);\r\n        emit PauserRemoved(account);\r\n    }\r\n}\r\n\r\ncontract Pausable is PauserRole {\r\n    /**\r\n     * @dev Emitted when the pause is triggered by a pauser (`account`).\r\n     */\r\n    event Paused(address account);\r\n\r\n    /**\r\n     * @dev Emitted when the pause is lifted by a pauser (`account`).\r\n     */\r\n    event Unpaused(address account);\r\n\r\n    bool private _paused;\r\n\r\n    /**\r\n     * @dev Initializes the contract in unpaused state. Assigns the Pauser role\r\n     * to the deployer.\r\n     */\r\n    constructor() internal {\r\n        _paused = false;\r\n    }\r\n\r\n    /**\r\n     * @dev Returns true if the contract is paused, and false otherwise.\r\n     */\r\n    function paused() public view returns (bool) {\r\n        return _paused;\r\n    }\r\n\r\n    /**\r\n     * @dev Modifier to make a function callable only when the contract is not paused.\r\n     */\r\n    modifier whenNotPaused() {\r\n        require(!_paused, \"Pausable: paused\");\r\n        _;\r\n    }\r\n\r\n    /**\r\n     * @dev Modifier to make a function callable only when the contract is paused.\r\n     */\r\n    modifier whenPaused() {\r\n        require(_paused, \"Pausable: not paused\");\r\n        _;\r\n    }\r\n\r\n    /**\r\n     * @dev Called by a pauser to pause, triggers stopped state.\r\n     */\r\n    function pause() public onlyPauser whenNotPaused {\r\n        _paused = true;\r\n        emit Paused(msg.sender);\r\n    }\r\n\r\n    /**\r\n     * @dev Called by a pauser to unpause, returns to normal state.\r\n     */\r\n    function unpause() public onlyPauser whenPaused {\r\n        _paused = false;\r\n        emit Unpaused(msg.sender);\r\n    }\r\n}\r\n\r\nlibrary SafeMath {\r\n    /**\r\n     * @dev Multiplies two numbers, throws on overflow.\r\n     */\r\n    function mul(uint256 a, uint256 b) internal pure returns (uint256 c) {\r\n        if (a == 0) {\r\n            return 0;\r\n        }\r\n        c = a * b;\r\n        require(c / a == b, \"SafeMath mul failed\");\r\n        return c;\r\n    }\r\n\r\n    /**\r\n     * @dev Subtracts two numbers, throws on overflow (i.e. if subtrahend is greater than minuend).\r\n     */\r\n    function sub(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        require(b <= a, \"SafeMath sub failed\");\r\n        return a - b;\r\n    }\r\n\r\n    /**\r\n     * @dev Adds two numbers, throws on overflow.\r\n     */\r\n    function add(uint256 a, uint256 b) internal pure returns (uint256 c) {\r\n        c = a + b;\r\n        require(c >= a, \"SafeMath add failed\");\r\n        return c;\r\n    }\r\n\r\n    /**\r\n     * @dev gives square root of given x.\r\n     */\r\n    function sqrt(uint256 x) internal pure returns (uint256 y) {\r\n        uint256 z = ((add(x, 1)) / 2);\r\n        y = x;\r\n        while (z < y) {\r\n            y = z;\r\n            z = ((add((x / z), z)) / 2);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @dev gives square. multiplies x by x\r\n     */\r\n    function sq(uint256 x) internal pure returns (uint256) {\r\n        return (mul(x, x));\r\n    }\r\n\r\n    /**\r\n     * @dev x to the power of y\r\n     */\r\n    function pwr(uint256 x, uint256 y) internal pure returns (uint256) {\r\n        if (x == 0) return (0);\r\n        else if (y == 0) return (1);\r\n        else {\r\n            uint256 z = x;\r\n            for (uint256 i = 1; i < y; i++) z = mul(z, x);\r\n            return (z);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @dev Integer division of two unsigned integers truncating the quotient, reverts on division by zero.\r\n     */\r\n    function div(uint256 a, uint256 b) internal pure returns (uint256) {\r\n        // Solidity only automatically asserts when dividing by 0\r\n        require(b > 0);\r\n        uint256 c = a / b;\r\n        // assert(a == b * c + a % b); // There is no case in which this doesn't hold\r\n\r\n        return c;\r\n    }\r\n}\r\n\r\ninterface DeporBetaUsersInterface {\r\n    function enroll() external;\r\n\r\n    function queryUserAddr(uint256 _userId)\r\n        external\r\n        view\r\n        returns (address addr);\r\n\r\n    function queryUserId(address _addr) external view returns (uint256 userId);\r\n\r\n    function isAddrRegistered(address user)\r\n        external\r\n        view\r\n        returns (bool registerd);\r\n}\r\n\r\ncontract DeporBetaUsers is\r\n    DeporBetaUsersInterface,\r\n    WhitelistAdminRole,\r\n    Pausable\r\n{\r\n    using SafeMath for uint256;\r\n\r\n    uint256 public userIdSeq = 0;\r\n    uint256 public userAmount = 0;\r\n\r\n    //address=>user\r\n    mapping(address => uint256) public addressToIds;\r\n    //userId=>user\r\n    mapping(uint256 => address) public idToAddresses;\r\n\r\n    //address=>bool\r\n    mapping(address => bool) public addrAlreadyEnrolled;\r\n\r\n    constructor() public {}\r\n\r\n    function kickUser(address addr) external whenNotPaused onlyWhitelistAdmin {\r\n        addrAlreadyEnrolled[addr] = false;\r\n        addressToIds[addr] = 0;\r\n        userAmount--;\r\n    }\r\n\r\n    /**\r\n     *  enroll\r\n     */\r\n    function enroll() external whenNotPaused {\r\n        //addr must been not enrolled\r\n        require(!isAddrRegistered(msg.sender), \"address have been enrolled\");\r\n\r\n        //addr cannot be contract\r\n        uint32 size;\r\n        address senderAddress = msg.sender;\r\n        assembly {\r\n            size := extcodesize(senderAddress)\r\n        }\r\n        require(size == 0, \"addr cannot be a contract\");\r\n\r\n        userIdSeq++;\r\n\r\n        //addr\r\n        addressToIds[msg.sender] = userIdSeq;\r\n        addrAlreadyEnrolled[msg.sender] = true;\r\n        idToAddresses[userIdSeq] = msg.sender;\r\n\r\n        userAmount++;\r\n        // emit onUserRegistry(gameId,nowUser.userId,nowUser.addr,nowUser.userName,nowUser.directInviteUserId);\r\n    }\r\n\r\n    function queryUserAddr(uint256 _userId)\r\n        external\r\n        view\r\n        returns (address userAddress)\r\n    {\r\n        userAddress = idToAddresses[_userId];\r\n    }\r\n\r\n    function queryUserId(address _addr) external view returns (uint256 userId) {\r\n        userId = addressToIds[_addr];\r\n    }\r\n\r\n    //\r\n    function isAddrRegistered(address user)\r\n        public\r\n        view\r\n        returns (bool registerd)\r\n    {\r\n        registerd = addrAlreadyEnrolled[user];\r\n    }\r\n\r\n    function queryUsersAmount() public view returns (uint256 totalAmount) {\r\n        totalAmount = userAmount;\r\n    }\r\n}"}}}