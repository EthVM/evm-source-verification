{
  "language": "Solidity",
  "settings": {
    "libraries": {},
    "metadata": {
      "useLiteralContent": true
    },
    "optimizer": {
      "enabled": true,
      "runs": 200
    },
    "remappings": [],
    "outputSelection": {
      "*": {
        "*": [
          "*"
        ],
        "": [
          "*"
        ]
      }
    }
  },
  "sources": {
    "MultiSourceOracle.sol": {
      "content": "// File: contracts/commons/Ownable.sol\r\n\r\npragma solidity ^0.6.6;\r\n\r\n\r\ncontract Ownable {\r\n    address internal _owner;\r\n\r\n    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);\r\n\r\n    /**\r\n     * @dev Initializes the contract setting the deployer as the initial owner.\r\n     */\r\n    constructor() internal {\r\n        _owner = msg.sender;\r\n        emit OwnershipTransferred(address(0), _owner);\r\n    }\r\n\r\n    /**\r\n     * @dev Returns the address of the current owner.\r\n     */\r\n    function owner() public view returns (address) {\r\n        return _owner;\r\n    }\r\n\r\n    /**\r\n     * @dev Throws if called by any account other than the owner.\r\n     */\r\n    modifier onlyOwner() {\r\n        require(msg.sender == _owner, \"Ownable: caller is not the owner\");\r\n        _;\r\n    }\r\n\r\n    /**\r\n     * @dev Transfers ownership of the contract to a new account (`newOwner`).\r\n     * Can only be called by the current owner.\r\n     */\r\n    function transferOwnership(address newOwner) external onlyOwner {\r\n        require(newOwner != address(0), \"Ownable: new owner is the zero address\");\r\n        emit OwnershipTransferred(_owner, newOwner);\r\n        _owner = newOwner;\r\n    }\r\n}\r\n\r\n// File: contracts/utils/StringUtils.sol\r\n\r\npragma solidity ^0.6.6;\r\n\r\n\r\nlibrary StringUtils {\r\n    function toBytes32(string memory _a) internal pure returns (bytes32 b) {\r\n        require(bytes(_a).length <= 32, \"string too long\");\r\n\r\n        assembly {\r\n            let bi := mul(mload(_a), 8)\r\n            b := and(mload(add(_a, 32)), shl(sub(256, bi), sub(exp(2, bi), 1)))\r\n        }\r\n    }\r\n}\r\n\r\n// File: contracts/diaspore/RateOracle.sol\r\n\r\npragma solidity ^0.6.6;\r\n\r\n\r\n/**\r\n    @dev Defines the interface of a standard Diaspore RCN Oracle,\r\n    The contract should also implement it's ERC165 interface: 0xa265d8e0\r\n    @notice Each oracle can only support one currency\r\n    @author Agustin Aguilar\r\n*/\r\nabstract contract RateOracle {\r\n    uint256 public constant VERSION = 5;\r\n    bytes4 internal constant RATE_ORACLE_INTERFACE = 0xa265d8e0;\r\n    \r\n    /**\r\n        3 or 4 letters symbol of the currency, Ej: ETH\r\n    */\r\n    function baseToken() external virtual view returns (string memory);\r\n\r\n\r\n    /**\r\n        3 or 4 letters symbol of the currency, Ej: ETH\r\n    */\r\n    function symbol() external virtual view returns (string memory);\r\n\r\n    /**\r\n        Descriptive name of the currency, Ej: Ethereum\r\n    */\r\n    function name() external virtual view returns (string memory);\r\n\r\n    /**\r\n        The number of decimals of the currency represented by this Oracle,\r\n            it should be the most common number of decimal places\r\n    */\r\n    function decimals() external virtual view returns (uint256);\r\n\r\n    /**\r\n        The base token on which the sample is returned\r\n            should be the RCN Token address.\r\n    */\r\n    function token() external virtual view returns (address);\r\n\r\n    /**\r\n        The currency symbol encoded on a UTF-8 Hex\r\n    */\r\n    function currency() external virtual view returns (bytes32);\r\n\r\n    /**\r\n        The name of the Individual or Company in charge of this Oracle\r\n    */\r\n    function maintainer() external virtual view returns (string memory);\r\n\r\n    /**\r\n        Returns the url where the oracle exposes a valid \"oracleData\" if needed\r\n    */\r\n    function url() external virtual view returns (string memory);\r\n\r\n    /**\r\n        Returns a sample on how many token() are equals to how many currency()\r\n    */\r\n    function readSample(bytes calldata _data) external virtual view returns (uint256 _tokens, uint256 _equivalent);\r\n}\r\n\r\n// File: contracts/interfaces/IOracleAdapter.sol\r\n\r\npragma solidity ^0.6.6;\r\n\r\n\r\ninterface IOracleAdapter {\r\n\r\n  function setAggregator(\r\n    bytes32 _symbolA,\r\n    bytes32 _symbolB,\r\n    address _aggregator\r\n  ) external;\r\n\r\n  function removeAggregator(bytes32 _symbolA, bytes32 _symbolB) external;\r\n  function getRate (bytes32[] calldata path) external view returns (uint256, uint256);\r\n  function latestTimestamp (bytes32[] calldata path) external view returns (uint256);\r\n\r\n  event RemoveAggregator(bytes32 _symbolA, bytes32 _symbolB, address _aggregator);\r\n  event SetAggregator(bytes32 _symbolA, bytes32 _symbolB, address _aggregator);\r\n}\r\n\r\n// File: contracts/utils/SafeMath.sol\r\n\r\npragma solidity ^0.6.6;\r\n\r\n\r\nlibrary SafeMath {\r\n    using SafeMath for uint256;\r\n\r\n    function add(uint256 x, uint256 y) internal pure returns (uint256) {\r\n        uint256 z = x + y;\r\n        require(z >= x, \"Add overflow\");\r\n        return z;\r\n    }\r\n\r\n    function sub(uint256 x, uint256 y) internal pure returns (uint256) {\r\n        require(x >= y, \"Sub overflow\");\r\n        return x - y;\r\n    }\r\n\r\n    function mult(uint256 x, uint256 y) internal pure returns (uint256) {\r\n        if (x == 0) {\r\n            return 0;\r\n        }\r\n\r\n        uint256 z = x * y;\r\n        require(z/x == y, \"Mult overflow\");\r\n        return z;\r\n    }\r\n\r\n    function div(uint256 x, uint256 y) internal pure returns (uint256) {\r\n        require(y != 0, \"Div by zero\");\r\n        return x / y;\r\n    }\r\n\r\n    function multdiv(uint256 x, uint256 y, uint256 z) internal pure returns (uint256) {\r\n        require(z != 0, \"div by zero\");\r\n        return x.mult(y) / z;\r\n    }\r\n}\r\n\r\n// File: contracts/interfaces/PausedProvided.sol\r\n\r\npragma solidity ^0.6.6;\r\n\r\n\r\ninterface PausedProvided {\r\n    function isPaused() external view returns (bool);\r\n}\r\n\r\n// File: contracts/commons/Pausable.sol\r\n\r\npragma solidity ^0.6.6;\r\n\r\n\r\n\r\ncontract Pausable is Ownable {\r\n    mapping(address => bool) public canPause;\r\n    bool public paused;\r\n\r\n    event Paused();\r\n    event Started();\r\n    event CanPause(address _pauser, bool _enabled);\r\n\r\n    function setPauser(address _pauser, bool _enabled) external onlyOwner {\r\n        canPause[_pauser] = _enabled;\r\n        emit CanPause(_pauser, _enabled);\r\n    }\r\n\r\n    function pause() external {\r\n        require(!paused, \"already paused\");\r\n\r\n        require(\r\n            msg.sender == _owner ||\r\n            canPause[msg.sender],\r\n            \"not authorized to pause\"\r\n        );\r\n\r\n        paused = true;\r\n        emit Paused();\r\n    }\r\n\r\n    function start() external onlyOwner {\r\n        require(paused, \"not paused\");\r\n        paused = false;\r\n        emit Started();\r\n    }\r\n}\r\n\r\n// File: contracts/diaspore/MultiSourceOracle.sol\r\n\r\npragma solidity ^0.6.6;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\ncontract MultiSourceOracle is RateOracle, Ownable, Pausable {\r\n    using StringUtils for string;\r\n    using SafeMath for uint256;\r\n\r\n    RateOracle public upgrade;\r\n\r\n    uint256 public ibase;\r\n    bytes32[] public path;\r\n    IOracleAdapter public oracleAdapter;\r\n    PausedProvided public pausedProvided;\r\n\r\n\r\n    string private isymbol;\r\n    string private iname;\r\n    uint256 private idecimals;\r\n    address private itoken;\r\n    string private ibaseToken;\r\n    bytes32 private icurrency;\r\n    string private imaintainer;\r\n\r\n    constructor(\r\n        IOracleAdapter _oracleAdapter,\r\n        string memory _baseToken,\r\n        uint256 _base,\r\n        string memory _symbol,\r\n        string memory _name,\r\n        uint256 _decimals,\r\n        address _token,\r\n        string memory _maintainer,\r\n        bytes32[] memory _path\r\n    ) public {\r\n        oracleAdapter = _oracleAdapter;\r\n        ibaseToken = _baseToken;\r\n        // Create legacy bytes32 currency\r\n        bytes32 currency = _symbol.toBytes32();\r\n        // Save Oracle metadata\r\n        isymbol = _symbol;\r\n        iname = _name;\r\n        idecimals = _decimals;\r\n        itoken = _token;\r\n        icurrency = currency;\r\n        imaintainer = _maintainer;\r\n        path = _path;\r\n        ibase = _base;\r\n        pausedProvided = PausedProvided(msg.sender);\r\n    }\r\n\r\n    /**\r\n        3 or 4 letters symbol of the currency, Ej: ETH\r\n    */\r\n    function baseToken() external override virtual view returns (string memory) {\r\n        return ibaseToken;\r\n    }\r\n\r\n    /**\r\n     * @return metadata, 3 or 4 letter symbol of the currency provided by this oracle\r\n     *   (ej: ARS)\r\n     * @notice Defined by the RCN RateOracle interface\r\n     */\r\n    function symbol() external override view returns (string memory) {\r\n        return isymbol;\r\n    }\r\n\r\n    /**\r\n     * @return metadata, full name of the currency provided by this oracle\r\n     *   (ej: Argentine Peso)\r\n     * @notice Defined by the RCN RateOracle interface\r\n     */\r\n    function name() external override view returns (string memory) {\r\n        return iname;\r\n    }\r\n\r\n    /**\r\n     * @return metadata, decimals to express the common denomination\r\n     *   of the currency provided by this oracle\r\n     * @notice Defined by the RCN RateOracle interface\r\n     */\r\n    function decimals() external override view returns (uint256) {\r\n        return idecimals;\r\n    }\r\n\r\n    /**\r\n     * @return metadata, token address of the currency provided by this oracle\r\n     * @notice Defined by the RCN RateOracle interface\r\n     */\r\n    function token() external override view returns (address) {\r\n        return itoken;\r\n    }\r\n\r\n    /**\r\n     * @return metadata, bytes32 code of the currency provided by this oracle\r\n     * @notice Defined by the RCN RateOracle interface\r\n     */\r\n    function currency() external override view returns (bytes32) {\r\n        return icurrency;\r\n    }\r\n\r\n    /**\r\n     * @return metadata, human readable name of the entity maintainer of this oracle\r\n     * @notice Defined by the RCN RateOracle interface\r\n     */\r\n    function maintainer() external override view returns (string memory) {\r\n        return imaintainer;\r\n    }\r\n\r\n    /**\r\n     * @dev Returns the URL required to retrieve the auxiliary data\r\n     *   as specified by the RateOracle spec, no auxiliary data is required\r\n     *   so it returns an empty string.\r\n     * @return An empty string, because the auxiliary data is not required\r\n     * @notice Defined by the RCN RateOracle interface\r\n     */\r\n    function url() external override view returns (string memory) {\r\n        return \"\";\r\n    }\r\n\r\n    /**\r\n     * @dev Updates the medatada of the oracle\r\n     * @param _name Name of the oracle currency\r\n     * @param _decimals Decimals for the common representation of the currency\r\n     * @param _maintainer Name of the maintainer entity of the Oracle\r\n     * @param _token, token address of the currency provided by this oracle\r\n     * @param _path, path to get the currency rate\r\n     */\r\n    function setMetadata(\r\n        string calldata _name,\r\n        uint256 _decimals,\r\n        string calldata _maintainer,\r\n        address _token,\r\n        bytes32[] calldata _path\r\n    ) external onlyOwner {\r\n        iname = _name;\r\n        idecimals = _decimals;\r\n        imaintainer = _maintainer;\r\n        itoken = _token;\r\n        path = _path;\r\n    }\r\n\r\n    /**\r\n     * @dev Updates the Oracle contract, all subsequent calls to `readSample` will be forwareded to `_upgrade`\r\n     * @param _upgrade Contract address of the new updated oracle\r\n     * @notice If the `upgrade` address is set to the address `0` the Oracle is considered not upgraded\r\n     */\r\n    function setUpgrade(RateOracle _upgrade) external onlyOwner {\r\n        upgrade = _upgrade;\r\n    }\r\n\r\n    /**\r\n     * @dev Reads the rate provided by the Oracle\r\n     *   this being the result of the resolved path by the oracle-adapter\r\n     * @param _oracleData Oracle auxiliar data defined in the RCN Oracle spec\r\n     *   not used for this oracle, but forwarded in case of upgrade.\r\n     * @return _tokens _equivalent `_equivalent` is the median of the values provided by the signer\r\n     *   `_tokens` are equivalent to `_equivalent` in the currency of the Oracle\r\n     */\r\n    function readSample(bytes memory _oracleData) public override view returns (uint256 _tokens, uint256 _equivalent) {\r\n        // Check if paused\r\n        require(!paused && !pausedProvided.isPaused(), \"contract paused\");\r\n\r\n        // Check if Oracle contract has been upgraded\r\n        RateOracle _upgrade = upgrade;\r\n        if (address(_upgrade) != address(0)) {\r\n            return _upgrade.readSample(_oracleData);\r\n        }\r\n\r\n        // Tokens is always base ;\r\n        (uint256 rate, uint256 dec) = oracleAdapter.getRate(path);\r\n        _tokens = ibase.mult(10 ** dec);\r\n        _equivalent = rate.mult(10 ** idecimals);\r\n    }\r\n\r\n    /**\r\n     * @dev Reads the rate provided by the Oracle\r\n     *   this being the result of the resolved path by the oracle-adapter\r\n     * @return _tokens _equivalent `_equivalent` is the median of the values provided by the signer\r\n     *   `_tokens` are equivalent to `_equivalent` in the currency of the Oracle\r\n     * @notice This Oracle accepts reading the sample without auxiliary data\r\n     */\r\n    function readSample() external view returns (uint256 _tokens, uint256 _equivalent) {\r\n        (_tokens, _equivalent) = readSample(new bytes(0));\r\n    }\r\n\r\n    /**\r\n     * @dev Reads the last timestamp when the oracle was updated\r\n     * @return timestamp last updated\r\n     * @notice If the sample rate is get from many oracles , the latest timestamp returns the older one\r\n     */\r\n    function latestTimestamp() external view returns (uint256 timestamp) {\r\n        timestamp = oracleAdapter.latestTimestamp(path);\r\n    }\r\n}"
    }
  }
}