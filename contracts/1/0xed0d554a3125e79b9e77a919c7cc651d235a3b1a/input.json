{"language":"Solidity","settings":{"libraries":{},"metadata":{"useLiteralContent":true},"optimizer":{"enabled":false,"runs":200},"remappings":[],"outputSelection":{"*":{"*":["*"],"":["*"]}}},"sources":{"LenderDeployer.sol":{"content":"// Verified using https://dapp.tools\n\n// hevm: flattened sources of src/lender/deployer.sol\npragma solidity >=0.5.15 <0.6.0;\n\n////// src/fixed_point.sol\n// Copyright (C) 2020 Centrifuge\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n/* pragma solidity >=0.5.15 <0.6.0; */\n\ncontract FixedPoint {\n    struct Fixed27 {\n        uint value;\n    }\n}\n\n////// src/lender/fabs/interfaces.sol\n// Copyright (C) 2020 Centrifuge\n\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n/* pragma solidity >=0.5.15 <0.6.0; */\n\ninterface ReserveFabLike_1 {\n    function newReserve(address) external returns (address);\n}\n\ninterface AssessorFabLike_2 {\n    function newAssessor() external returns (address);\n}\n\ninterface TrancheFabLike_1 {\n    function newTranche(address, address) external returns (address);\n}\n\ninterface CoordinatorFabLike_2 {\n    function newCoordinator(uint) external returns (address);\n}\n\ninterface OperatorFabLike_1 {\n    function newOperator(address) external returns (address);\n}\n\ninterface MemberlistFabLike_1 {\n    function newMemberlist() external returns (address);\n}\n\ninterface RestrictedTokenFabLike_1 {\n    function newRestrictedToken(string calldata, string calldata) external returns (address);\n}\n\ninterface AssessorAdminFabLike {\n    function newAssessorAdmin() external returns (address);\n}\n\n\n\n////// src/lender/deployer.sol\n// Copyright (C) 2020 Centrifuge\n\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n/* pragma solidity >=0.5.15 <0.6.0; */\n\n/* import { ReserveFabLike, AssessorFabLike, TrancheFabLike, CoordinatorFabLike, OperatorFabLike, MemberlistFabLike, RestrictedTokenFabLike, AssessorAdminFabLike } from \"./fabs/interfaces.sol\"; */\n\n/* import {FixedPoint}      from \"./../fixed_point.sol\"; */\n\n\ninterface DependLike_2 {\n    function depend(bytes32, address) external;\n}\n\ninterface AuthLike_2 {\n    function rely(address) external;\n    function deny(address) external;\n}\n\ninterface MemberlistLike_1 {\n    function updateMember(address, uint) external;\n}\n\ninterface FileLike_2 {\n    function file(bytes32 name, uint value) external;\n}\n\ncontract LenderDeployer is FixedPoint {\n    address public root;\n    address public currency;\n\n    // factory contracts\n    TrancheFabLike_1          public trancheFab;\n    ReserveFabLike_1          public reserveFab;\n    AssessorFabLike_2         public assessorFab;\n    CoordinatorFabLike_2      public coordinatorFab;\n    OperatorFabLike_1         public operatorFab;\n    MemberlistFabLike_1       public memberlistFab;\n    RestrictedTokenFabLike_1  public restrictedTokenFab;\n    AssessorAdminFabLike    public assessorAdminFab;\n\n    // lender state variables\n    Fixed27             public minSeniorRatio;\n    Fixed27             public maxSeniorRatio;\n    uint                public maxReserve;\n    uint                public challengeTime;\n    Fixed27             public seniorInterestRate;\n\n\n    // contract addresses\n    address             public assessor;\n    address             public assessorAdmin;\n    address             public seniorTranche;\n    address             public juniorTranche;\n    address             public seniorOperator;\n    address             public juniorOperator;\n    address             public reserve;\n    address             public coordinator;\n\n    address             public seniorToken;\n    address             public juniorToken;\n\n    // token names\n    string              public seniorName;\n    string              public seniorSymbol;\n    string              public juniorName;\n    string              public juniorSymbol;\n    // restricted token member list\n    address             public seniorMemberlist;\n    address             public juniorMemberlist;\n\n    address             public deployer;\n\n    constructor(address root_, address currency_, address trancheFab_, address memberlistFab_, address restrictedtokenFab_, address reserveFab_, address assessorFab_, address coordinatorFab_, address operatorFab_, address assessorAdminFab_) public {\n\n        deployer = msg.sender;\n        root = root_;\n        currency = currency_;\n\n        trancheFab = TrancheFabLike_1(trancheFab_);\n        memberlistFab = MemberlistFabLike_1(memberlistFab_);\n        restrictedTokenFab = RestrictedTokenFabLike_1(restrictedtokenFab_);\n        reserveFab = ReserveFabLike_1(reserveFab_);\n        assessorFab = AssessorFabLike_2(assessorFab_);\n        assessorAdminFab = AssessorAdminFabLike(assessorAdminFab_);\n        coordinatorFab = CoordinatorFabLike_2(coordinatorFab_);\n        operatorFab = OperatorFabLike_1(operatorFab_);\n    }\n\n    function init(uint minSeniorRatio_, uint maxSeniorRatio_, uint maxReserve_, uint challengeTime_, uint seniorInterestRate_, string memory seniorName_, string memory seniorSymbol_, string memory juniorName_, string memory juniorSymbol_) public {\n        require(msg.sender == deployer);\n        challengeTime = challengeTime_;\n        minSeniorRatio = Fixed27(minSeniorRatio_);\n        maxSeniorRatio = Fixed27(maxSeniorRatio_);\n        maxReserve = maxReserve_;\n        seniorInterestRate = Fixed27(seniorInterestRate_);\n\n        // token names\n        seniorName = seniorName_;\n        seniorSymbol = seniorSymbol_;\n        juniorName = juniorName_;\n        juniorSymbol = juniorSymbol_;\n\n        deployer = address(1);\n    }\n\n    function deployJunior() public {\n        require(juniorTranche == address(0) && deployer == address(1));\n        juniorToken = restrictedTokenFab.newRestrictedToken(juniorName, juniorSymbol);\n        juniorTranche = trancheFab.newTranche(currency, juniorToken);\n        juniorMemberlist = memberlistFab.newMemberlist();\n        juniorOperator = operatorFab.newOperator(juniorTranche);\n        AuthLike_2(juniorMemberlist).rely(root);\n        AuthLike_2(juniorToken).rely(root);\n        AuthLike_2(juniorToken).rely(juniorTranche);\n        AuthLike_2(juniorOperator).rely(root);\n        AuthLike_2(juniorTranche).rely(root);\n    }\n\n    function deploySenior() public {\n        require(seniorTranche == address(0) && deployer == address(1));\n        seniorToken = restrictedTokenFab.newRestrictedToken(seniorName, seniorSymbol);\n        seniorTranche = trancheFab.newTranche(currency, seniorToken);\n        seniorMemberlist = memberlistFab.newMemberlist();\n        seniorOperator = operatorFab.newOperator(seniorTranche);\n        AuthLike_2(seniorMemberlist).rely(root);\n        AuthLike_2(seniorToken).rely(root);\n        AuthLike_2(seniorToken).rely(seniorTranche);\n        AuthLike_2(seniorOperator).rely(root);\n        AuthLike_2(seniorTranche).rely(root);\n\n    }\n\n    function deployReserve() public {\n        require(reserve == address(0) && deployer == address(1));\n        reserve = reserveFab.newReserve(currency);\n        AuthLike_2(reserve).rely(root);\n    }\n\n    function deployAssessor() public {\n        require(assessor == address(0) && deployer == address(1));\n        assessor = assessorFab.newAssessor();\n        AuthLike_2(assessor).rely(root);\n    }\n\n    function deployAssessorAdmin() public {\n        require(assessorAdmin == address(0) && deployer == address(1));\n        assessorAdmin = assessorAdminFab.newAssessorAdmin();\n        AuthLike_2(assessorAdmin).rely(root);\n    }\n\n    function deployCoordinator() public {\n        require(coordinator == address(0) && deployer == address(1));\n        coordinator = coordinatorFab.newCoordinator(challengeTime);\n        AuthLike_2(coordinator).rely(root);\n    }\n\n    function deploy() public {\n        require(coordinator != address(0) && assessor != address(0) &&\n                reserve != address(0) && seniorTranche != address(0));\n\n        // required depends\n        // reserve\n        DependLike_2(reserve).depend(\"assessor\", assessor);\n        AuthLike_2(reserve).rely(seniorTranche);\n        AuthLike_2(reserve).rely(juniorTranche);\n        AuthLike_2(reserve).rely(coordinator);\n        AuthLike_2(reserve).rely(assessor);\n\n\n        // tranches\n        DependLike_2(seniorTranche).depend(\"reserve\",reserve);\n        DependLike_2(juniorTranche).depend(\"reserve\",reserve);\n        AuthLike_2(seniorTranche).rely(coordinator);\n        AuthLike_2(juniorTranche).rely(coordinator);\n        AuthLike_2(seniorTranche).rely(seniorOperator);\n        AuthLike_2(juniorTranche).rely(juniorOperator);\n\n        // coordinator implements epoch ticker interface\n        DependLike_2(seniorTranche).depend(\"epochTicker\", coordinator);\n        DependLike_2(juniorTranche).depend(\"epochTicker\", coordinator);\n\n        //restricted token\n        DependLike_2(seniorToken).depend(\"memberlist\", seniorMemberlist);\n        DependLike_2(juniorToken).depend(\"memberlist\", juniorMemberlist);\n\n        //allow tinlake contracts to hold drop/tin tokens\n        MemberlistLike_1(juniorMemberlist).updateMember(juniorTranche, uint(-1));\n        MemberlistLike_1(seniorMemberlist).updateMember(seniorTranche, uint(-1));\n\n        // operator\n        DependLike_2(seniorOperator).depend(\"tranche\", seniorTranche);\n        DependLike_2(juniorOperator).depend(\"tranche\", juniorTranche);\n        DependLike_2(seniorOperator).depend(\"token\", seniorToken);\n        DependLike_2(juniorOperator).depend(\"token\", juniorToken);\n\n\n        // coordinator\n        DependLike_2(coordinator).depend(\"reserve\", reserve);\n        DependLike_2(coordinator).depend(\"seniorTranche\", seniorTranche);\n        DependLike_2(coordinator).depend(\"juniorTranche\", juniorTranche);\n        DependLike_2(coordinator).depend(\"assessor\", assessor);\n\n        // assessor\n        DependLike_2(assessor).depend(\"seniorTranche\", seniorTranche);\n        DependLike_2(assessor).depend(\"juniorTranche\", juniorTranche);\n        DependLike_2(assessor).depend(\"reserve\", reserve);\n\n        AuthLike_2(assessor).rely(coordinator);\n        AuthLike_2(assessor).rely(reserve);\n        AuthLike_2(assessor).rely(assessorAdmin);\n\n        // assessorAdmin\n        DependLike_2(assessorAdmin).depend(\"assessor\", assessor);\n\n        FileLike_2(assessor).file(\"seniorInterestRate\", seniorInterestRate.value);\n        FileLike_2(assessor).file(\"maxReserve\", maxReserve);\n        FileLike_2(assessor).file(\"maxSeniorRatio\", maxSeniorRatio.value);\n        FileLike_2(assessor).file(\"minSeniorRatio\", minSeniorRatio.value);\n    }\n}\n"}}}