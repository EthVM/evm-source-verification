{"language":"Solidity","settings":{"libraries":{},"metadata":{"useLiteralContent":true},"optimizer":{"enabled":false,"runs":200},"remappings":[],"outputSelection":{"*":{"*":["*"],"":["*"]}}},"sources":{"InstaAaveV1PowerResolver.sol":{"content":"pragma solidity ^0.6.0;\r\npragma experimental ABIEncoderV2;\r\n\r\ninterface AaveInterface {\r\n    function getUserReserveData(address _reserve, address _user) external view returns (\r\n        uint256 currentATokenBalance,\r\n        uint256 currentBorrowBalance,\r\n        uint256 principalBorrowBalance,\r\n        uint256 borrowRateMode,\r\n        uint256 borrowRate,\r\n        uint256 liquidityRate,\r\n        uint256 originationFee,\r\n        uint256 variableBorrowIndex,\r\n        uint256 lastUpdateTimestamp,\r\n        bool usageAsCollateralEnabled\r\n    );\r\n\r\n    function getUserAccountData(address user) external view returns (\r\n        uint256 totalLiquidityETH,\r\n        uint256 totalCollateralETH,\r\n        uint256 totalBorrowsETH,\r\n        uint256 totalFeesETH,\r\n        uint256 availableBorrowsETH,\r\n        uint256 currentLiquidationThreshold,\r\n        uint256 ltv,\r\n        uint256 healthFactor\r\n    );\r\n}\r\n\r\ninterface AaveProviderInterface {\r\n    function getLendingPool() external view returns (address);\r\n}\r\n\r\ninterface ChainLinkInterface {\r\n    function latestAnswer() external view returns (int256);\r\n    function decimals() external view returns (uint256);\r\n}\r\n\r\ncontract Helpers {\r\n\r\n    struct AaveData {\r\n        uint collateral;\r\n        uint debt;\r\n    }\r\n\r\n    struct data {\r\n        address user;\r\n        AaveData[] tokensData;\r\n    }\r\n    \r\n    struct datas {\r\n        AaveData[] tokensData;\r\n    }\r\n\r\n    /**\r\n     * @dev get Aave Provider Address\r\n    */\r\n    function getAaveProviderAddress() internal pure returns (address) {\r\n        return 0x24a42fD28C976A61Df5D00D0599C34c4f90748c8; //mainnet\r\n        // return 0x506B0B2CF20FAA8f38a4E2B524EE43e1f4458Cc5; //kovan\r\n    }\r\n\r\n    /**\r\n     * @dev get Chainlink ETH price feed Address\r\n    */\r\n    function getChainlinkEthFeed() internal pure returns (address) {\r\n        return 0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419; //mainnet\r\n        // return 0x9326BFA02ADD2366b30bacB125260Af641031331; //kovan\r\n    }\r\n}\r\n\r\ncontract InstaAaveV1PowerResolver is Helpers {\r\n    function getEthPrice() public view returns (uint ethPrice) {\r\n        ethPrice = uint(ChainLinkInterface(getChainlinkEthFeed()).latestAnswer());\r\n    }\r\n    \r\n    function getAaveDataByReserve(address[] memory owners, address reserve, AaveInterface aave) public view returns (AaveData[] memory) {\r\n        AaveData[] memory tokensData = new AaveData[](owners.length);\r\n        for (uint i = 0; i < owners.length; i++) {\r\n            (uint collateral, uint debt,,,,,,,,) = aave.getUserReserveData(reserve, owners[i]);\r\n            tokensData[i] = AaveData(\r\n                collateral,\r\n                debt\r\n            );\r\n        }\r\n\r\n        return tokensData;\r\n    }\r\n\r\n    function getPositionByAddress(\r\n        address[] memory owners,\r\n        address[] memory reserves\r\n    )\r\n        public\r\n        view\r\n        returns (datas[] memory)\r\n    {\r\n        AaveProviderInterface AaveProvider = AaveProviderInterface(getAaveProviderAddress());\r\n        AaveInterface aave = AaveInterface(AaveProvider.getLendingPool());\r\n        datas[] memory _data = new datas[](reserves.length);\r\n        for (uint i = 0; i < reserves.length; i++) {\r\n            _data[i] = datas(\r\n                getAaveDataByReserve(owners, reserves[i], aave)\r\n            );\r\n        }\r\n        return _data;\r\n    }\r\n\r\n    function getPositionByAddress(\r\n        address[] memory owners\r\n    )\r\n        public\r\n        view\r\n        returns (AaveData[] memory)\r\n    {   \r\n        AaveProviderInterface AaveProvider = AaveProviderInterface(getAaveProviderAddress());\r\n        AaveInterface aave = AaveInterface(AaveProvider.getLendingPool());\r\n        AaveData[] memory tokensData = new AaveData[](owners.length);\r\n\r\n        for (uint i = 0; i < owners.length; i++) {\r\n            (\r\n            ,\r\n            uint totalCollateralETH,\r\n            uint totalBorrowsETH,\r\n            ,,,,) = aave.getUserAccountData(owners[i]);\r\n\r\n            tokensData[i] = AaveData(\r\n                totalCollateralETH,\r\n                totalBorrowsETH\r\n            );\r\n        }\r\n\r\n        return tokensData;\r\n    }\r\n\r\n}"}}}